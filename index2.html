<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>@obsessed_vampires</title>
</head>
<body>
<h1>Obsessed Vampires</h1>
<input id="searchInput" placeholder="Шукати..." />
<div id="cards"></div>

<script>
const SHEET_ID = "16FR9S-8fO4VaiHiY6yEWWmnhB9_NjB48HSYJD58vKrs";
const TAB_NAME = "Аркуш1";
const sheetUrl = `https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(TAB_NAME)}`;

let data = [];

async function loadData() {
  const res = await fetch(sheetUrl);
  const json = await res.json();

  data = json.map(row => {
    // універсальне визначення колонок
    const titleKey = Object.keys(row).find(k => /title|назва/i.test(k));
    const keywordsKey = Object.keys(row).find(k => /keyword|ключ/i.test(k));
    const tagsKey = Object.keys(row).find(k => /tag|тег/i.test(k));
    const linkKey = Object.keys(row).find(k => /link|посилання/i.test(k));

    const title = row[titleKey]?.trim() || 'Без назви';
    const keywords = row[keywordsKey]
      ? row[keywordsKey].split(/[,;]+/).map(s=>s.trim().toLowerCase()).filter(Boolean)
      : [];
    const tags = row[tagsKey]
      ? row[tagsKey].split(/[/;]+/).map(s=>s.trim().toLowerCase()).filter(Boolean)
      : [];
    let link = row[linkKey]?.trim() || '#';
    if(link.startsWith('tg://')) link = link.replace(/^tg:\/\/resolve\?domain=/,'https://t.me/');

    return {title, keywords, tags, link};
  });

  renderCards(data);
}

function renderCards(items) {
  const container = document.getElementById('cards');
  container.innerHTML = '';
  if(!items.length) { container.innerHTML='<p>Нічого не знайдено</p>'; return; }

  items.forEach(item => {
    const tagsHtml = item.tags.map(t => `<span>${t}</span>`).join(' ');
    const card = document.createElement('div');
    card.innerHTML = `<h3>${item.title}</h3><div>${tagsHtml}</div><a href="${item.link}" target="_blank">Переглянути</a>`;
    container.appendChild(card);
  });
}

// пошук по всіх полях
document.getElementById('searchInput').addEventListener('input', e => {
  const term = e.target.value.toLowerCase().trim();
  const filtered = data.filter(item => {
    const all = [item.title.toLowerCase(), ...item.keywords, ...item.tags];
    return all.some(word => word.includes(term));
  });
  renderCards(filtered);
});

loadData();
</script>
</body>
</html>
