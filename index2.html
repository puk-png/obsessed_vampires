<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>@obsessed_vampires</title>
</head>
<body>
<h1>Obsessed Vampires</h1>
<input id="searchInput" placeholder="Шукати..." />
<div id="cards"></div>

<script>
const SHEET_ID = "16FR9S-8fO4VaiHiY6yEWWmnhB9_NjB48HSYJD58vKrs";
const TAB_NAME = "Аркуш1";
const sheetUrl = `https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(TAB_NAME)}`;

let data = [];

async function loadData() {
  const res = await fetch(sheetUrl);
  const json = await res.json();

  data = json.map(row => {
    // знайти ключі незалежно від пробілів і регістру
    const titleKey = Object.keys(row).find(k=>k.toLowerCase().includes('title') || k.toLowerCase().includes('назва'));
    const keywordsKey = Object.keys(row).find(k=>k.toLowerCase().includes('keyword') || k.toLowerCase().includes('ключ'));
    const tagsKey = Object.keys(row).find(k=>k.toLowerCase().includes('tag') || k.toLowerCase().includes('тег'));
    const linkKey = Object.keys(row).find(k=>k.toLowerCase().includes('link') || k.toLowerCase().includes('посилання'));

    const title = titleKey ? row[titleKey].trim() : 'Без назви';
    const keywords = keywordsKey ? row[keywordsKey].split(/[,;]/).map(s=>s.trim().toLowerCase()) : [];
    const tags = tagsKey ? row[tagsKey].split('/').map(s=>s.trim().toLowerCase()) : [];
    let link = linkKey ? row[linkKey].trim() : '#';
    // виправляємо tg:// на https://t.me/
    if(link.startsWith('tg://')) link = link.replace(/^tg:\/\/resolve\?domain=/,'https://t.me/');
    
    return {title, keywords, tags, link};
  });

  renderCards(data);
}

function renderCards(items) {
  const container = document.getElementById('cards');
  container.innerHTML = '';
  if(!items.length) { container.innerHTML='<p>Нічого не знайдено</p>'; return; }
  items.forEach(item => {
    const tagsHtml = item.tags.map(t=>`<span>${t}</span>`).join(' ');
    const card = document.createElement('div');
    card.innerHTML = `<h3>${item.title}</h3><div>${tagsHtml}</div><a href="${item.link}" target="_blank">Переглянути</a>`;
    container.appendChild(card);
  });
}

// Пошук: будь-який термін з назви, ключових слів чи тегів
document.getElementById('searchInput').addEventListener('input', e=>{
  const terms = e.target.value.toLowerCase().split(/\s+/).filter(Boolean);
  const filtered = data.filter(item=>{
    const all = [item.title.toLowerCase(), ...item.keywords, ...item.tags];
    return terms.every(term => all.some(word=>word.includes(term)));
  });
  renderCards(filtered);
});

loadData();
</script>
</body>
</html>
